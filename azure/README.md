### Prerequisites
1. An Azure account
2. The `az` CLI, [installed](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) and [logged in](https://learn.microsoft.com/en-us/cli/azure/authenticate-azure-cli).
3. Create an active directory service principal with the following command (must be [logged in](https://sourcegraph.slack.com/archives/C021PRG65DH/p1674744535754359?thread_ts=1674486051.389039&cid=C021PRG65DH) first): `az ad sp create-for-rbac --skip-assignment`. You will use the output from these commands to set your variables in `terraform.tfvars`, so hold on to it.

### Set your variables
1. Form and clone this repository to your local machine. 
2. `cd` into `az`, then uncomment and replace variables in `terraform.tfvars` with the desired values generated by the command in step 3 of the "Prerequisites" section above. Check `variables.tf` for default values.

### Deploy the cluster
From inside the `./azure` directory of this project
1. Run `terraform init`. This will initialize the terraform project.
2. Run `terraform plan`. This will perform a dry run and find any problems with your configuration.
3. Run `terraform apply`. This will deploy an AKS cluster to Azure. Type 'yes' at the prompt.

A successful deployment will result in a success message. At this point, you may wish to use `kubectl` to manage your cluster. Instructions for doing so are in the README in the root directory of this repository.

Congrats! You have a Kubernetes cluster! Next, [it's time to deploy Sourcegraph](https://docs.sourcegraph.com/admin/deploy/kubernetes/configure)!

### Destroy the Cluster
1. Run `terraform destroy`. Answer yes at the prompt.

